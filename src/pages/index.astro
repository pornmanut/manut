---
import BlogLayout from '../layouts/BlogLayout.astro';
import { getCollection } from 'astro:content';
import PostCardEnhanced from '../components/PostCardEnhanced.astro';
import TagFilter from '../components/TagFilter.astro';
import Header from '../components/Header.astro';

// Get all blog posts, excluding drafts
const allPosts = await getCollection('blog', ({ data }) => {
	return data.draft !== true;
});

// Sort posts by publication date (newest first)
const sortedPosts = allPosts.sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

// Separate featured posts
const featuredPosts = sortedPosts.filter(post => post.data.featured);
const regularPosts = sortedPosts.filter(post => !post.data.featured);
---

<BlogLayout title="My Blog - Personal Thoughts & Stories">
	<Header currentPath="/" />
	
	<div class="container mx-auto px-4">
		<div class="grid gap-8 lg:grid-cols-[1fr_300px]">
			<main class="space-y-8">
				
				{featuredPosts.length > 0 && (
					<section>
						<h2 class="text-2xl font-bold mb-6">Featured Posts</h2>
						<div class="grid gap-6 md:grid-cols-2">
							{featuredPosts.map((post) => (
								<PostCardEnhanced post={post} />
							))}
						</div>
					</section>
				)}
				
				<section>
					<h2 class="text-2xl font-bold mb-6">Recent Posts</h2>
					{regularPosts.length > 0 ? (
						<div class="grid gap-6 md:grid-cols-2">
							{regularPosts.map((post) => (
								<PostCardEnhanced post={post} />
							))}
						</div>
					) : (
						<p class="text-muted-foreground">No posts yet. Check back soon!</p>
					)}
				</section>
			</main>
			
			<aside>
				<TagFilter />
			</aside>
		</div>
	</div>
</BlogLayout>
