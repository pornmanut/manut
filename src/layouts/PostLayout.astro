---
import BlogLayout from './BlogLayout.astro';
import Header from '../components/Header.astro';
import type { CollectionEntry } from 'astro:content';
import { render } from 'astro:content';

export interface Props {
	post: CollectionEntry<'blog'>;
}

const { post } = Astro.props;
const { Content, headings } = await render(post);
---

<BlogLayout title={post.data.title} description={post.data.description}>
	<Header currentPath={`/blog/${post.id}/`} />
	
	<div class="content-wrapper">
		<main class="main-content">
			<article>
				<header>
					<h1>{post.data.title}</h1>
					<p class="post-meta">
						<time datetime={post.data.pubDate.toISOString()}>
							{post.data.pubDate.toLocaleDateString('en-US', { 
								year: 'numeric', 
								month: 'long', 
								day: 'numeric' 
							})}
						</time>
						{post.data.updatedDate && (
							<span> â€¢ Updated {post.data.updatedDate.toLocaleDateString('en-US', { 
								year: 'numeric', 
								month: 'long', 
								day: 'numeric' 
							})}</span>
						)}
					</p>
					{post.data.heroImage && (
						<img 
							src={post.data.heroImage} 
							alt={post.data.title}
							class="hero-image"
						/>
					)}
				</header>
				<div class="post-content">
					<Content />
				</div>
				<footer>
					{post.data.tags.length > 0 && (
						<div class="tags">
							<h3>Tags</h3>
							<ul>
								{post.data.tags.map((tag) => (
									<li><a href={`/blog/tag/${tag}`}>{tag}</a></li>
								))}
							</ul>
						</div>
					)}
				</footer>
			</article>
		</main>
		<aside class="sidebar">
			<div class="back-to-blog">
				<a href="/">&larr; Back to all posts</a>
			</div>
			{headings.length > 0 && (
				<div class="table-of-contents">
					<h3>Table of Contents</h3>
					<ul>
						{headings.map((heading) => (
							<li>
								<a href={`#${heading.slug}`}>{heading.text}</a>
							</li>
						))}
					</ul>
				</div>
			)}
		</aside>
	</div>

	<style>
		.post-meta {
			color: var(--secondary-color);
			font-family: var(--font-ui);
			font-size: 0.9rem;
			margin-bottom: 24px;
		}

		.hero-image {
			width: 100%;
			margin-bottom: 32px;
		}

		.post-content {
			margin-bottom: 48px;
		}

		.post-content h2 {
			margin-top: 32px;
			margin-bottom: 16px;
		}

		.post-content h3 {
			margin-top: 24px;
			margin-bottom: 12px;
		}

		.post-content p {
			margin-bottom: 16px;
		}

		.post-content img {
			margin: 24px 0;
		}

		.tags {
			border-top: 1px solid var(--border-color);
			padding-top: 24px;
		}

		.tags h3 {
			font-size: 1.2rem;
			margin-bottom: 12px;
		}

		.tags ul {
			display: flex;
			flex-wrap: wrap;
			gap: 8px;
			list-style: none;
		}

		.tags li {
			background-color: var(--card-background);
			padding: 6px 12px;
			border-radius: 16px;
			font-size: 0.9rem;
			font-family: var(--font-ui);
		}

		.tags a {
			color: var(--primary-color);
		}

		.back-to-blog {
			margin-bottom: 32px;
			padding: 16px;
			background-color: var(--card-background);
			border-radius: 8px;
		}

		.back-to-blog a {
			font-family: var(--font-ui);
			font-weight: 500;
		}

		.table-of-contents {
			position: sticky;
			top: 20px;
			padding: 16px;
			background-color: var(--card-background);
			border-radius: 8px;
		}

		.table-of-contents h3 {
			font-size: 1.2rem;
			margin-bottom: 12px;
		}

		.table-of-contents ul {
			list-style: none;
		}

		.table-of-contents li {
			margin-bottom: 8px;
		}

		.table-of-contents a {
			font-family: var(--font-ui);
			font-size: 0.9rem;
			color: var(--secondary-color);
		}

		.table-of-contents a:hover {
			color: var(--accent-color);
		}
	</style>
</BlogLayout>
