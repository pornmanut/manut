---
import BlogLayout from './BlogLayout.astro';
import Header from '../components/Header.astro';
import type { CollectionEntry } from 'astro:content';
import { render } from 'astro:content';

export interface Props {
	post: CollectionEntry<'blog'>;
}

const { post } = Astro.props;
const { Content, headings } = await render(post);
---

<BlogLayout title={post.data.title} description={post.data.description}>
	<Header currentPath={`/blog/${post.id}/`} />
	
	<div class="container mx-auto px-4 py-8 max-w-4xl">
		<main>
			<article class="max-w-none">
				<header class="mb-8">
					<h1 class="text-4xl font-bold mb-4 font-serif">{post.data.title}</h1>
					<p class="text-muted-foreground text-sm font-sans mb-6">
						<time datetime={post.data.pubDate.toISOString()}>
							{post.data.pubDate.toLocaleDateString('en-US', { 
								year: 'numeric', 
								month: 'long', 
								day: 'numeric' 
							})}
						</time>
						{post.data.updatedDate && (
							<span> • Updated {post.data.updatedDate.toLocaleDateString('en-US', { 
								year: 'numeric', 
								month: 'long', 
								day: 'numeric' 
							})}</span>
						)}
					</p>
					{post.data.heroImage && (
						<img 
							src={post.data.heroImage} 
							alt={post.data.title}
							class="w-full rounded-lg mb-8"
						/>
					)}
				</header>
				<div class="prose prose-gray max-w-none">
					<style>
						.prose {
							color: hsl(0 0% 3.9%);
							max-width: none;
							line-height: 1.75;
						}
						
						.prose h1 {
							font-size: 2.25em;
							margin-top: 0;
							margin-bottom: 0.8888889em;
							line-height: 1.1111111;
							font-weight: 700;
						}
						
						.prose h2 {
							font-size: 1.5em;
							margin-top: 2em;
							margin-bottom: 1em;
							line-height: 1.3333333;
							font-weight: 700;
						}
						
						.prose h3 {
							font-size: 1.25em;
							margin-top: 1.6em;
							margin-bottom: 0.6em;
							line-height: 1.6;
							font-weight: 700;
						}
						
						.prose p {
							margin-top: 1.25em;
							margin-bottom: 1.25em;
						}
						
						.prose ul {
							list-style-type: disc;
							margin-top: 1.25em;
							margin-bottom: 1.25em;
							padding-left: 1.625em;
						}
						
						.prose li {
							margin-top: 0.5em;
							margin-bottom: 0.5em;
						}
						
						.prose li > p {
							margin-top: 0.75em;
							margin-bottom: 0.75em;
						}
						
						.dark .prose {
							color: hsl(0 0% 98%);
						}
					</style>
					<Content />
				</div>
				<footer class="mt-12 pt-8 border-t">
					{post.data.tags.length > 0 && (
						<div class="mb-8">
							<h3 class="text-xl font-semibold mb-4 font-serif">Tags</h3>
							<div class="flex flex-wrap gap-2">
								{post.data.tags.map((tag) => (
									<a 
										href={`/blog/tag/${tag}`}
										class="inline-flex items-center rounded-full bg-secondary px-3 py-1 text-sm font-medium text-secondary-foreground hover:bg-secondary/80 transition-colors"
									>
										{tag}
									</a>
								))}
							</div>
						</div>
					)}
				</footer>
			</article>
		</main>
		<aside class="mt-12 lg:mt-0 lg:sticky lg:top-8 lg:h-fit">
			<div class="bg-card rounded-lg p-6 mb-6 border">
				<a 
					href="/"
					class="inline-flex items-center text-primary hover:underline font-medium"
				>
					← Back to all posts
				</a>
			</div>
			{headings.length > 0 && (
				<div class="bg-card rounded-lg p-6 border">
					<h3 class="text-xl font-semibold mb-4 font-serif">Table of Contents</h3>
					<nav>
						<ul class="space-y-2">
							{headings.map((heading) => (
								<li>
									<a 
										href={`#${heading.slug}`}
										class="text-muted-foreground hover:text-primary transition-colors text-sm font-sans"
									>
										{heading.text}
									</a>
								</li>
							))}
						</ul>
					</nav>
				</div>
			)}
		</aside>
	</div>
</BlogLayout>
